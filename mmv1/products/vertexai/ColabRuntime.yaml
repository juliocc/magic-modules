# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
name: 'ColabRuntime'
description: |
  A runtime is a virtual machine allocated to a particular user for a particular Notebook file
  on temporary basis with lifetime limited to 24 hours.
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    'Official documentation': 'https://cloud.google.com/vertex-ai/docs'
  api: 'https://cloud.google.com/vertex-ai/docs/reference/rest/v1beta1/projects.locations.notebookRuntimes'
base_url: 'projects/{{project}}/locations/{{region}}/notebookRuntimes'
self_link: 'projects/{{project}}/locations/{{region}}/notebookRuntimes/{{name}}'
create_url: 'projects/{{project}}/locations/{{region}}/notebookRuntimes:assign'
identity: ['name']
immutable: true
async: !ruby/object:Api::OpAsync
  actions:
    - create
    - delete
    - update
  operation: !ruby/object:Api::OpAsync::Operation
    path: 'name'
    base_url: '{{op_id}}'
    wait_ms: 1000
  result: !ruby/object:Api::OpAsync::Result
    path: 'response'
    resource_inside_response: true
  status: !ruby/object:Api::OpAsync::Status
    path: 'done'
    complete: true
    allowed:
      - true
      - false


  # #include_project: true
  # operation: !ruby/object:Api::OpAsync::Operation
  #   path: 'name'
  #   base_url: '{{op_id}}'
  # # result: !ruby/object:Api::OpAsync::Result
  # #   resource_inside_response: true
  # status: !ruby/object:Api::OpAsync::Status
  #   path: 'done'
  #   complete: true
  #   allowed:
  #     - true
  #     - false
examples:
  - !ruby/object:Provider::Terraform::Examples
    name: 'vertex_ai_notebook_runtime_basic'
    primary_resource_id: 'default'
    primary_resource_name: 'fmt.Sprintf("runtime-%s, context["random_suffix"])'
    vars:
      runtime_name: 'runtime-template'
parameters:
  - !ruby/object:Api::Type::String
    name: "region"
    required: true
    url_param_only: true
    description: |
      The region where the runtime template should be created.
  - !ruby/object:Api::Type::String
    name: "name"
    output: true
    custom_flatten: templates/terraform/custom_flatten/name_from_self_link.erb
    description: |
      Name of the Runtime Template.
properties:
  - !ruby/object:Api::Type::String
    name: 'notebookRuntimeTemplate'
    # TODO: reuse?
    description: |
      The resource name of the NotebookRuntimeTemplate based on which a NotebookRuntime will be assigned (reuse or create a new one).
    required: true
  - !ruby/object:Api::Type::String
    name: 'notebookRuntimeId'
    # TODO: reuse?
    description: |
      User specified ID for the notebook runtime.

  - !ruby/object:Api::Type::NestedObject
    name: 'notebookRuntime'
    description: |
      runtime specific information (e.g. runtime owner, notebook id) used for NotebookRuntime assignment.
    properties:    
      - !ruby/object:Api::Type::String
        name: 'runtimeUser'
        description: |
          The user email of the NotebookRuntime
        required: true
      - !ruby/object:Api::Type::NestedObject
        name: 'notebookRuntimeTemplateRef'
        description: |
          The pointer to the NotebookRuntimeTemplate this NotebookRuntime is created from
        properties:
          - !ruby/object:Api::Type::String
            name: 'notebookRuntimeTemplate'
            description: |
              A resource name of the NotebookRuntimeTemplate
            immutable: true
      - !ruby/object:Api::Type::String
        name: 'proxyUri'
        description: |
          The proxy endpoint used to access the NotebookRuntime
      - !ruby/object:Api::Type::Time
        name: 'createTime'
        description: |
          Timestamp when this notebook runtime was created
        output: true
      - !ruby/object:Api::Type::Time
        name: 'updateTime'
        description: |
          Timestamp when this notebook runtime was recently updated
        output: true
      - !ruby/object:Api::Type::Enum
        name: 'healthState'
        description: |
          The health state of the notebook runtime
        output: true
        values:
          - :HEALTHY
          - :UNHEALTHY
      - !ruby/object:Api::Type::String
        name: 'displayName'
        description: |
          The display name of the notebook runtime
        required: true
      - !ruby/object:Api::Type::String
        name: 'description'
        description: |
          The description of the notebook runtime
      - !ruby/object:Api::Type::String
        name: 'serviceAccount'
        description: |
          The service account that the notebook runtime workload runs as
        output: true
      - !ruby/object:Api::Type::Enum
        name: 'runtimeState'
        description: |
          The runtime (instance) state of the notebook runtime
        output: true
        values:
          - :RUNNING
          - :BEING_STARTED
          - :BEING_STOPPED
          - :STOPPED
          - :BEING_UPGRADED
          - :ERROR
          - :INVALID
      - !ruby/object:Api::Type::Boolean
        name: 'isUpgradable'
        description: |
          Whether the notebook runtime is upgradable
        output: true
      # - !ruby/object:Api::Type::KeyValueLabels
      #   name: 'labels'
      #   description: |
      #     The labels with user-defined metadata to organize your notebook runtime
      - !ruby/object:Api::Type::Time
        name: 'expirationTime'
        description: |
          Timestamp when the notebook runtime will be expired
        output: true
      - !ruby/object:Api::Type::String
        name: 'version'
        description: |
          The VM OS image version of the notebook runtime
        output: true
      - !ruby/object:Api::Type::Enum
        name: 'notebookRuntimeType'
        description: |
          The type of the notebook runtime
        output: true
        values:
          - :USER_DEFINED
          - :ONE_CLICK
      - !ruby/object:Api::Type::Array
        name: 'networkTags'
        description: |
          The Compute Engine tags to add to the runtime
        item_type: Api::Type::String


